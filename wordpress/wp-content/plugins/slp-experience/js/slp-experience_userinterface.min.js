var SLPEXP={};SLPEXP.email_form={built:false,build_form:function(){if(this.built)return;jQuery("#email_form").dialog({autoOpen:false,minHeight:50,minWidth:450,title:slpexperience_settings.email_form_title,buttons:{Send:function(){SLPEXP.email_form.send_email();jQuery(this).dialog("close")},Cancel:function(){jQuery(this).dialog("close")}}});this.built=true},send_email:function(){var ajax=new slp.Ajax;var action={action:"email_form",formdata:jQuery("#the_email_form").serialize()};ajax.send(action,function(response){});return true},set_form_content:function(sl_id){jQuery("#the_email_form input[name=sl_id]").val(sl_id)},show_form:function(sl_id){SLPEXP.email_form.set_form_content(sl_id);jQuery("#email_form").dialog("open");return false}};SLPEXP.location_list={first_load:true,clear_widget_search:function(){jQuery("#searchForm [id^=slp_widget]").remove()},disable_directory:function(){if(SLPEXP.location_list.first_load&&typeof slplus.options.disable_initial_directory!=="undefined"&&slplus.options.disable_initial_directory=="1"){jQuery("div#map_sidebar").hide()}else{jQuery("div#map_sidebar").show();jQuery("#map_sidebar").off("contentchanged",SLPEXP.location_list.disable_directory)}SLPEXP.location_list.first_load=false},setup_subscriptions:function(){jQuery("#map_sidebar").on("contentchanged",SLPEXP.location_list.clear_widget_search);jQuery("#map_sidebar").on("contentchanged",SLPEXP.email_form.build_form)}};SLPEXP.address_quicksearch={attach_ui_handler:function(){if(typeof slplus.options["address_autocomplete"]!="undefined"&&slplus.options["address_autocomplete"]==="zipcode"){jQuery("#addressInput").autocomplete({source:SLPEXP.address_quicksearch.query_locations,minLength:slplus.options.address_autocomplete_min})}},query_locations:function(request,callback){post_vars={action:"slp_list_location_zips",address:request.term};jQuery.post(slplus.ajaxurl,post_vars,function(results){callback(JSON.parse(results))})}};SLPEXP.search_form={show_state_selection:function(){var state_widget="[id=slp_widget\\[state\\]]";if(jQuery(state_widget).length){jQuery("#searchForm [id=addressInputState]:visible").val(jQuery(state_widget).val())}}};SLPEXP.selector_handler={address_value:"",current_value:{addressInputState:""},attach_ui_handler:function(){if(typeof slplus.options["selector_behavior"]!="undefined"&&slplus.options["selector_behavior"]==="either_or"){jQuery("#addressInput").click(SLPEXP.selector_handler.activate);jQuery("#addressInputCity").click(SLPEXP.selector_handler.activate);jQuery("#addressInputState").click(SLPEXP.selector_handler.activate);jQuery("#addressInputCountry").click(SLPEXP.selector_handler.activate)}},activate:function(){element_name=jQuery(this).attr("name");switch(element_name){case"addressInputCity":case"addressInputState":case"addressInputCountry":SLPEXP.selector_handler.save_address();SLPEXP.selector_handler.restore_dropdown_selection(element_name);break;case"addressInput":SLPEXP.selector_handler.save_dropdown_selection("addressInputCity");SLPEXP.selector_handler.save_dropdown_selection("addressInputState");SLPEXP.selector_handler.save_dropdown_selection("addressInputCountry");SLPEXP.selector_handler.restore_address();break}},restore_address:function(){current_address_value=jQuery("#addressInput").val();if(!current_address_value){jQuery("#addressInput").val(this.address_value);this.address_value=""}},restore_dropdown_selection:function(element_name){element_id="#"+element_name;current_value=jQuery(element_id).find("option:selected").val();if(!current_value&&this.current_value[element_name]){option_by_val=element_id+' option[value="'+SLPEXP.selector_handler.current_value[element_name]+'"]';jQuery(element_id).val(SLPEXP.selector_handler.current_value[element_name]);jQuery(element_id).blur();jQuery(element_id).focus();jQuery(option_by_val).prop("selected",true);jQuery(element_id).show();this.current_value[element_name]=""}},save_address:function(){current_address_value=jQuery("#addressInput").val();if(current_address_value){SLPEXP.selector_handler.address_value=current_address_value;jQuery("#addressInput").val("")}},save_dropdown_selection:function(element_name){element_id="#"+element_name;current_value=jQuery(element_id).find("option:selected").val();if(current_value){SLPEXP.selector_handler.current_value[element_name]=current_value;jQuery(element_id).val("")}}};SLPEXP.map={setup_subscriptions:function(){slp_Filter("map_options").subscribe(this.modify_options)},modify_options:function(map_options){map_options.mapTypeControl=slpexperience_settings.map_options_mapTypeControl==="1";map_options.scrollwheel=slpexperience_settings.map_options_scrollwheel==="1";map_options.scaleControl=slpexperience_settings.map_options_scaleControl==="1";map_options.hide_bubble=slpexperience_settings.hide_bubble==="1"}};jQuery(document).ready(function(){SLPEXP.selector_handler.attach_ui_handler();SLPEXP.address_quicksearch.attach_ui_handler();SLPEXP.map.setup_subscriptions();SLPEXP.location_list.setup_subscriptions();SLPEXP.search_form.show_state_selection();jQuery("#map_sidebar").on("contentchanged",SLPEXP.location_list.disable_directory)});