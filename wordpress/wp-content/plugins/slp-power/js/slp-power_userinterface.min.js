var SLPPOWER={};var slplus=slplus||{options:{use_sensor:"0"}};var slp_LocationServices=function(){this.service=null;this.location_timeout=null;this.lat=0;this.lng=0;this.get_user_location=function(callback,errorCallback){if(typeof navigator.geolocation==="undefined"){if(google.gears){this.service=google.gears.factory.create("beta.geolocation")}}else{this.service=navigator.geolocation}if(this.service){slp.sensor.location_timeout=setTimeout(errorCallback,5e3);this.service.getCurrentPosition(callback,errorCallback,{maximumAge:6e4,timeout:5e3,enableHighAccuracy:true})}else{slp.sensor.geocode_with_no_sensor()}};this.initialize=function(){cslmap.usingSensor=true;this.get_user_location(function(loc){clearTimeout(slp.sensor.location_timeout);slp.sensor.lat=loc.coords.latitude;slp.sensor.lng=loc.coords.longitude;cslmap.build_map(new google.maps.LatLng(loc.coords.latitude,loc.coords.longitude))},function(){clearTimeout(slp.sensor.location_timeout);slp.sensor.geocode_with_no_sensor()})};this.geocode_with_no_sensor=function(){slplus.options.use_sensor="0";cslmap.usingSensor=false;cslmap.doGeocode()}};SLPPOWER.map=function(){var center,location_id;this.initialize=function(){jQuery("[title='location_map']").each(function(){location_id=jQuery(this).attr("data-location_id");get_location_data(location_id)})};this.add_this_location=function(data){var add_map,map_div_id,marker_settings;map_div_id=document.getElementById("map-canvas-"+data.sl_id);center=new google.maps.LatLng(data.sl_latitude,data.sl_longitude);add_map=new slp_Map;slplus.options.immediately_show_locations="0";slp_Filter("map_options").subscribe(this.modify_add_map_options);add_map.build_map(center,map_div_id);marker_settings={position:center,map:add_map.gmap,icon:slppower_settings.map_end_icon};new google.maps.Marker(marker_settings);slp_Filter("map_options").unsubscribe(this.modify_add_map_options)};this.get_location_data=function(location_id){jQuery.ajax(slppower_settings.resturl+"locations/"+location_id,{success:add_this_location})};this.modify_add_map_options=function(map_options){map_options.zoom=14};return{initialize:initialize,modify_add_map_options:modify_add_map_options}}();jQuery(document).ready(function(){SLPPOWER.map.initialize();if(slplus.options.use_sensor!=="0"){slp.sensor=new slp_LocationServices;slp.sensor.initialize()}});